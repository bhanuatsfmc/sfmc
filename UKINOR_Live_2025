<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://www.smith-nephew.com/assets/head/?v=lCtdyL9hWcNhgOrwD6wZ5SkrHpECjEkDkcl0QP06bh81">
    <link rel="icon" href = "https://image.digital.smith-nephew.com/lib/fe3211737364047e751177/m/1/48107551-6b7e-419f-9ad3-2676a4239229.png">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cloud.digital.smith-nephew.com/datalayer" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <title>Imperial Sports Knee Meeting lead form</title>
    <script runat="server">
    Platform.Load("Core","1.1.1");
    try{
    </script>
    <!--
%%[
/*
Don't forget to chagne:
1. <title></title> in HTML;
2. campaign id, campaign status, DE name, consent source in AMPscript;
3. if tracking is needed add correct value to DL_formname input in HTML
 */
 
/* --- ON PAGE LOAD --- */
set @param = QueryParameter("embedded")
set @MID = AuthenticatedMemberID()
IF @MID == "536003181" THEN
   SET @RecordTypeId = "012Dd000000GqdCIAS"
ELSE
   SET @RecordTypeId = "0124P000000OSkwQAG"
ENDIF
SET @dateAdded = Now(1)
SET @dateAdded = SystemDateToLocalDate(@dateAdded)

 /* --- AFTER SUBMISSION --- */
IF RequestParameter("sn_form_submit") == "submit" THEN

/* -- Need to change -- */
  SET @campID = "701Jy00000jjBC4IAM"
  SET @DERecords = "UK-SPM-Imperial-2025"
  SET @consentSource = "UK-SPM-Imperial-2025-leadform"

  SET @campStatus = "Form filled"
  

  SET @display = "ThankYou"
  SET @firstName= RequestParameter("sn_form_first_name")
  SET @lastName= RequestParameter("sn_form_last_name")
  SET @email = RequestParameter("sn_form_email")
  SET @country= "United Kingdom"
  SET @interest= RequestParameter("interest")
  SET @comment= RequestParameter("sn_form_message")
  SET @consentForm = RequestParameter("marketingconsent")

  set @marketingconsent = Iif(not Empty(@consentForm), "True", "False")
  
  

  SET @contactRows = RetrieveSalesforceObjects("Contact", "Id, Dotdigital_Account__c,Consent_Source__c", "Email", "=", @email)
  SET @leadRows = RetrieveSalesforceObjects("Lead", "Id, Dotdigital_Account__c,Consent_Source__c", "Email", "=", @email)
  
  /* --- CONTACT --- */
  IF RowCount(@contactRows) > 0 THEN
    SET @contactRow = Row(@contactRows, 1)
    SET @id = Field(@contactRow, "Id")
    SET @consentCRM = Field(@contactRow, "Dotdigital_Account__c")
    SEt @consentSourceCRM = Field(@contactRow, "Consent_Source__c") 
    set @userType = "Contact" 
    
    
  /* --- EXISTING LEAD --- */  
  ELSEIF RowCount(@contactRows) == 0 AND RowCount(@leadRows) > 0 THEN
    SET @leadRow = Row(@leadRows, 1)
    SET @id = Field(@leadRow, "Id")
    SET @consentCRM = Field(@leadRow, "Dotdigital_Account__c")
    SEt @consentSourceCRM = Field(@leadRow, "Consent_Source__c") 
    set @userType = "Lead"
    SET @LeadUpdate = UpdateSingleSalesforceObject(
                "Lead", @id,
                "LastName", @lastName,
                "FirstName", @firstName,
                "Country",@country
               )
               
  /* --- NEW LEAD --- */  
  ELSE
   SET @Id = CreateSalesforceObject("Lead", 8,
                  "RecordTypeId",@RecordTypeId,
                  "Status", "New",
                  "LastName", @lastName, 
                  "FirstName", @firstName,
                  "Email", @email,
                  "Consent_type__c", "Single",
                  "Lead_Source_Name__c", @consentSource,
                  "Country",@country
                )
     set @userType = "Lead"
    ENDIF
    
    /* --- Updates --- */
    set @DEUpdate = insertData(@DERecords,"SubscriberKey", @Id,"Email", @email, "FirstName", @firstName, "LastName", @lastName,"Interest",@Interest,"Consent",@marketingconsent,"Comment",@Comment,"Inserted",@dateAdded,"Country",@country) 
    
    IF (@consentCRM != "True" AND @marketingconsent == "True") THEN
      SET @updateContact = UpdateSingleSalesforceObject(
                  @userType, @id,
                  "Dotdigital_Account__c", "True",
                  "Consent_Source__c",@consentSource
                )
 
    ENDIF
   
    /*Check if CampMember exits; if not create new*/
    SET @campUser = concat(@userType,"Id")
    SET @CampMemberRows = RetrieveSalesforceObjects("CampaignMember", "Id", @campUser, "=", @id, "CampaignId", "=", @campID)
    IF RowCount(@CampMemberRows) < 1 THEN
      SET @createCampMember = CreateSalesforceObject(
            "CampaignMember", 3,
             @campUser, @id,
            "Status", @campStatus,
            "CampaignId", @campID
          )
    ENDIF
    
/* --- Task declaration --- */
  
  SET @nowGMT = DateAdd(Now(),7,"h")
  SET @nowPlus14Days = DateAdd(@nowGMT, 14, "D")
  SET @nowPlus14Days = Format(@nowPlus14Days,"yyyy-MM-dd")
  SET @nowPlus7Days = DateAdd(@nowGMT, 7, "D")
  SET @nowPlus7Days = FormatDate(@nowPlus7Days,"ISO")
  SET @newline = char(10,2)
  
  SET @description = Concat("A new contact requested a sales visit from Imperial Sports Knee Meeting 2025",
    @newline, "First Name: ", @firstName,
    @newline, "Last Name: ", @lastName,
    @newline, "Email: ", @email,
    @newline, "Product interest: ", @interest,
    @newline, "Comment sent with the request : ", @comment
    )
    /*Task creation*/
    
    SET @sellingteam = "SPM"
    IF @country == "United Kingdom" then
      SET @newTask = CreateSalesforceObject('task',11,
        'WhoId',@Id,
        'ActivityDate',@nowPlus14Days, 
        'Subject','Sales visit request from Imperial Sports Knee Meeting 2025', 
        'Status', 'Open',
        'Priority','High',
        'Description', @description,
        'Campaign__c', @campID,
        'IsReminderSet', 'true',
        'ReminderDateTime', @nowPlus7Days,
        'Country__c',@country,
        'Selling_Team__c',@sellingteam
      )
    ENDIF
   
 
  ENDIF
ENDIF
]%%
-->
  <script runat="server">
}catch(e){
 Write(Stringify(e));
}
  </script>
 
  <style>
    .sr-only {
      position: absolute;
      opacity: 0;
      cursor: pointer;
      height: 0;
      width: 0;
    }  
    .form fieldset{
        margin-bottom: 1em;
    }
    .form fieldset legend {
      margin-bottom: 1em;
    }
    .form input[type=checkbox] ~ label {
      width: auto;
      line-height: 1.5;
    }
    .form input[type=checkbox] {
     vertical-align: middle;
    }
    .form label {
      display: initial;
    }
  </style> 
  </head>
  <body class="form-background">
    %%[IF EMPTY(@param) THEN]%% 
    <header>
      <div class="header__user-nav" style="opacity: 1; transform: translate(0px, 0px)">
        <div class="user-nav__inner">
          <div class="user-nav__brand-mark">
            <a href="https://www.smith-nephew.com/en">
              <img class="brand-mark__image" src="https://www.smith-nephew.com/-/media/project/smithandnephew/examples/logo.svg"
                   alt="Smith+Nephew brand logo">
            </a>
          </div>
        </div>
      </div>
     
    </header>
    %%[ENDIF]%% 
    <main class="viewport__inner">
      <!-- placeholder: main -->
     <article class="alchemy form" data-animation-marked="alchemy:0">
        <div class="form__wrapper">
          <div style="transform: translate(0px, 0px); opacity: 1; width: 100%">
            <form action="%%=RequestParameter('PAGEURL')=%%" method="post" id="form" class="form">
             %%[IF EMPTY(@display) THEN]%%
              %%[IF EMPTY(@param) THEN]%% 
              <div style="margin-top: 1rem; margin-bottom:0.75rem;">
                 <h2>Get in touch</h2>
              </div>
             %%[ENDIF]%% 
              <div class="form__group">
                <div class="form__element">
                  <label for="sn_form_first_name" style="height: 19px">First name *</label>
                  <input id="sn_form_first_name" name="sn_form_first_name" type="text" required>
                </div>
                <div class="form__element">
                  <label for="sn_form_last_name" style="height: 19px">Last name *</label>
                  <input id="sn_form_last_name" name="sn_form_last_name" type="text" required>
                </div>
              </div>
              <div class="form__element">
                <label for="sn_form_email" class="">Email Address *</label>
                <input id="sn_form_email" name="sn_form_email"type="email" required>
              </div>  
              
      
            
              <fieldset>
                  <legend>Interest</legend>
                <div class="form__text">
                    <p>Which topic would you like to receive more information about?</p>
                </div>
                
                <div class="form__group form__group--full form__group--checkbox">
                  
                  <div class="form__element">
                  <input type="checkbox" id="interest1" name="interest" value="FAST-FIX FLEX">
                  <span class="checkbox"></span>
                  <label for="interest1">FAST-FIX<sup>◊</sup> FLEX</label>
                  </div>
                   <div class="form__element">
                  <input type="checkbox" id="interest2" name="interest" value="ULTRABUTTON">
                    <span class="checkbox"></span>
                  <label for="interest2">ULTRABUTTON<sup>◊</sup> </label>
                  </div>
                   <div class="form__element">
                 <input type="checkbox" id="interest3" name="interest" value="QUADTRAC">
                   <span class="checkbox"></span>
                 <label for="interest3">QUADTRAC<sup>◊</sup></label>
                  </div>
                                      
                 <div class="form__element">
                 <input type="checkbox" id="interest4" name="interest" value="Podcast">
                   <span class="checkbox"></span>
                 <label for="interest4">Podcast: 30 years of meniscal repair: Expert insights from patient selection to recovery</label>
                  </div>
                   <div class="form__element">
                 <input type="checkbox" id="interest5" name="interest" value="Webinar">
                     <span class="checkbox"></span>
                 <label for="interest5">Webinar: 30 years of meniscal repair: Common challenges and solutions</label>
                  </div>
                  
                </div>
                </fieldset>
              
               <div class="form__element">
                <label for="sn_form_message" style="height: 19px">Comments / questions:</label>
                <textarea id="sn_form_message" name="sn_form_message" maxlength="4000"></textarea>
                 <p id="charcounter">4000/4000</p>
            </div>
              <div>
                    <input type="checkbox" id="marketingconsent" name="marketingconsent" value="true">
                    <label for="marketingconsent">Sign up for marketing updates to stay connected with info about S+N and topics around your areas of interest.</label>
                
              </div>
              
              <button type="submit" class="cta-button cta-button--primary cta-button--large" name="sn_form_submit" value="submit">
                <span class="cta-button__label">Submit</span>
                <span class="cta-button__icon sn-icon-navigation-right"></span>
              </button>
              %%[IF EMPTY(@param) THEN]%% 
                <div class="form__text">
  <p style="margin-top: 15px;"> 
                  By submitting this form, I agree to the 
                  <a href="https://www.smith-nephew.com/en/terms-of-use" target="_blank">terms of use</a>, 
                  <a href="https://www.smith-nephew.com/en/privacy-notice" target="_blank">S+N privacy policy</a> and 
                  <a href="https://www.smith-nephew.com/en/privacy-notice" target="_blank">S+N cookie notice.</a> 
                </p><p><sup>◊</sup> Trademark of Smith+Nephew</p>
                </div>
              %%[ELSE]%%
              <div class="form__text">
                <p style="margin-top: 15px;"> You can view the S+N "Terms of Use" and "Privacy and Cookies" notice in the links below.</p>
              </div>
             
             %%[ENDIF]%%
            %%[ELSE]%%
              <br>
          <h2>
          Thank you!
        </h2>
          <p>Your form has been successfully submitted.
          </p>
        %%[ENDIF]%%
               <div class="wrap-spinner">
                <div class="spinner ellipsis-spinner"></div>
              </div>
               <input type="hidden" id="DL_formname" name="DL_formname" value="UK-SPM-Imperial-2025-leadform">
              <input type="hidden" id="DL_formtype" name="DL_formtype" value="lead gen">
            </form>

            <!-- /place_holder: /main/form-container -->
          </div>
        
        </div>
      </article>
      <!-- /place_holder: main -->
    </main>
  </body>
  <script>
console.log("v1");
$(document).ready(function () {
  const characterCount = $("#charcounter");
  const textarea = $("#sn_form_message");
  textarea.on('input', function () {
      const currentCount = textarea.val().length;
      const remainingChars = 4000 - currentCount;
      characterCount.text(`${remainingChars}/4000`);
    });
});
    
  </script>
</html>
